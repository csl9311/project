--CREATE USER CONO IDENTIFIED BY CONO;
--GRANT RESOURCE, CONNECT TO CONO;
--GRANT CREATE VIEW TO CONO;

SELECT * FROM ALL_CONSTRAINTS;

DROP TABLE ADDRESS;
DROP TABLE MEMBER;
DROP TABLE GRADE;

CREATE SEQUENCE SEQ_ADDRESS_CODE;

CREATE TABLE GRADE(GRADE_CODE NUMBER PRIMARY KEY,GRADE VARCHAR2(9) NOT NULL);
CREATE TABLE MEMBER(
	ID VARCHAR2(30) PRIMARY KEY,
	PW VARCHAR2(20) NOT NULL,
	NAME VARCHAR2(15) NOT NULL,
    NICKNAME VARCHAR2(30) UNIQUE NOT NULL,
	PHONE VARCHAR2(13) NOT NULL,
	GENDER VARCHAR2(1) NOT NULL,
	EMAIL VARCHAR2(20) NOT NULL,
	STATUS VARCHAR2(1) DEFAULT 'Y',
    BIRTH DATE NOT NULL,
	REGDATE DATE,
	MODIFYDATE DATE,
    POINT NUMBER DEFAULT 0,
    NEWS NUMBER,
    SMS NUMBER,
    GRADE_CODE NUMBER REFERENCES GRADE(GRADE_CODE)
);
CREATE TABLE ADDRESS(
	ADDRESS_CODE NUMBER PRIMARY KEY,
	POSTNUM VARCHAR2(5) DEFAULT '-',
	ADDRESS VARCHAR2(300) DEFAULT '-',
    ADDRESS_DETAIL VARCHAR2(300) DEFAULT '-',
    ID VARCHAR2(30) REFERENCES MEMBER(ID)
);

INSERT INTO GRADE VALUES(1, '일반');
INSERT INTO GRADE VALUES(2, '사장님');
INSERT INTO GRADE VALUES(3, '관리자');
INSERT INTO GRADE VALUES(4, '휴면');
INSERT INTO GRADE VALUES(5, '블랙');
INSERT INTO MEMBER VALUES('admin', '1234', 'name', '관리자', '010-0101-0101', 'M', 'email', DEFAULT, SYSDATE, SYSDATE, SYSDATE, DEFAULT, 0 ,1, 3);
INSERT INTO MEMBER VALUES('id', 'pw', 'name', 'nickname', '010-0101-0101', 'M', 'email', DEFAULT, SYSDATE, SYSDATE, SYSDATE, DEFAULT, 0 ,1, 2);
INSERT INTO MEMBER VALUES('asd', 'pw', 'name', 'asd', '010-0101-0101', 'M', 'email', DEFAULT, SYSDATE, SYSDATE, SYSDATE, DEFAULT, 0 ,1, 1);
INSERT INTO MEMBER VALUES('zxc', 'pw', 'name', 'zxc', '010-0101-0101', 'M', 'email', DEFAULT, SYSDATE, SYSDATE, SYSDATE, DEFAULT, 0 ,1, 1);
INSERT INTO MEMBER VALUES('qwe', 'pw', 'name', 'qwe', '010-0101-0101', 'M', 'email', DEFAULT, SYSDATE, SYSDATE, SYSDATE, DEFAULT, 0 ,1, 1);
INSERT INTO MEMBER VALUES('wer', 'pw', 'name', 'wer', '010-0101-0101', 'M', 'email', DEFAULT, SYSDATE, SYSDATE, SYSDATE, DEFAULT, 0 ,1, 1);
INSERT INTO MEMBER VALUES('sdf', 'pw', 'name', 'sdf', '010-0101-0101', 'M', 'email', DEFAULT, SYSDATE, SYSDATE, SYSDATE, DEFAULT, 0 ,1, 1);
INSERT INTO MEMBER VALUES('xcv', 'pw', 'name', 'xcv', '010-0101-0101', 'M', 'email', DEFAULT, SYSDATE, SYSDATE, SYSDATE, DEFAULT, 0 ,1, 1);
INSERT INTO ADDRESS VALUES(0, DEFAULT, DEFAULT, DEFAULT, 'admin');
INSERT INTO ADDRESS VALUES(1, DEFAULT, DEFAULT, DEFAULT, 'admin');
INSERT INTO ADDRESS VALUES(2, DEFAULT, DEFAULT, DEFAULT, 'admin');
INSERT INTO ADDRESS VALUES(3, DEFAULT, DEFAULT, DEFAULT, 'admin');
INSERT INTO ADDRESS VALUES(4, DEFAULT, DEFAULT, DEFAULT, 'admin');
INSERT INTO ADDRESS VALUES(5, DEFAULT, DEFAULT, DEFAULT, 'admin');
INSERT INTO ADDRESS VALUES(6, DEFAULT, DEFAULT, DEFAULT, 'admin');
INSERT INTO ADDRESS VALUES(7, DEFAULT, DEFAULT, DEFAULT, 'admin');
SELECT * FROM ADDRESS;
SELECT * FROM GRADE;
SELECT * FROM MEMBER;
commit;


-- 관리자 회원정보조회 뷰
CREATE OR REPLACE VIEW MEMBER_VIEW
AS
SELECT *
FROM MEMBER
    JOIN GRADE USING(GRADE_CODE)
WHERE STATUS = 'Y';
select * from MEMBER_VIEW;
commit;





-- SQL 작성시
INSERT INTO ADDRESS VALUES(SEQ_ADDRESS_CODE.NEXTVAL, ?, ?, ?); -- 주소 업데이트
UPDATE supervisor_member SET NAME = ?, NICKNAME = ?, PHONE = ?, GENDER = ?, EMAIL = ?, GRADE = ?, MODIFYDATE = ?, NEWS = ?, SMS = ? WHERE ID = ?;
SELECT * FROM ADDRESS WHERE ID=?; -- 주소 가져올때