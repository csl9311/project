--CREATE USER CONO IDENTIFIED BY CONO;
--GRANT RESOURCE, CONNECT TO CONO;
--GRANT CREATE VIEW TO CONO;

SELECT * FROM ALL_CONSTRAINTS;

DROP TABLE ADDRESS;
CREATE TABLE ADDRESS(
	ADDRESS_CODE NUMBER PRIMARY KEY,
	POSTNUM VARCHAR2(15) DEFAULT '-',
	ADDRESS VARCHAR2(30) DEFAULT '-',
    ADDRESS_DETAIL VARCHAR2(60) DEFAULT '-'
);
INSERT INTO ADDRESS VALUES(0, DEFAULT, DEFAULT, DEFAULT);
INSERT INTO ADDRESS VALUES(1, DEFAULT, DEFAULT, DEFAULT);
INSERT INTO ADDRESS VALUES(2, DEFAULT, DEFAULT, DEFAULT);
INSERT INTO ADDRESS VALUES(3, DEFAULT, DEFAULT, DEFAULT);
INSERT INTO ADDRESS VALUES(4, DEFAULT, DEFAULT, DEFAULT);
INSERT INTO ADDRESS VALUES(5, DEFAULT, DEFAULT, DEFAULT);
INSERT INTO ADDRESS VALUES(6, DEFAULT, DEFAULT, DEFAULT);
INSERT INTO ADDRESS VALUES(7, DEFAULT, DEFAULT, DEFAULT);

SELECT * FROM ADDRESS;

DROP TABLE GRADE;
CREATE TABLE GRADE(
	GRADE_CODE NUMBER PRIMARY KEY,
	GRADE VARCHAR2(9) NOT NULL
);

INSERT INTO GRADE VALUES(1, '일반');
INSERT INTO GRADE VALUES(2, '사장님');
INSERT INTO GRADE VALUES(3, '관리자');
INSERT INTO GRADE VALUES(4, '휴면');
INSERT INTO GRADE VALUES(5, '블랙');
SELECT * FROM GRADE;

DROP TABLE MEMBER;
CREATE TABLE MEMBER(
	ID VARCHAR2(10) PRIMARY KEY,
	PW VARCHAR2(20) NOT NULL,
	NAME VARCHAR2(10) NOT NULL,
    NICKNAME VARCHAR2(30) UNIQUE NOT NULL,
	PHONE VARCHAR2(15) NOT NULL,
	GENDER VARCHAR2(3) NOT NULL,

	EMAIL VARCHAR2(20) NOT NULL,
	STATUS VARCHAR2(1) DEFAULT 'Y',
    BIRTH DATE NOT NULL,
	REGDATE DATE,
	MODIFYDATE DATE,
    POINT NUMBER DEFAULT 0,
    NEWS NUMBER,
    SMS NUMBER,
    ADDRESS_CODE NUMBER REFERENCES ADDRESS(ADDRESS_CODE),
    GRADE_CODE NUMBER REFERENCES GRADE(GRADE_CODE)
);
INSERT INTO MEMBER VALUES('admin', '1234', 'name', '관리자', '010-0101-0101', 'M', 'email', DEFAULT, SYSDATE, SYSDATE, SYSDATE, DEFAULT, 0 ,1, 1, 3);
INSERT INTO MEMBER VALUES('id', 'pw', 'name', 'nickname', '010-0101-0101', 'M', 'email', DEFAULT, SYSDATE, SYSDATE, SYSDATE, DEFAULT, 0 ,1, 1, 2);
INSERT INTO MEMBER VALUES('asd', 'pw', 'name', 'asd', '010-0101-0101', 'M', 'email', DEFAULT, SYSDATE, SYSDATE, SYSDATE, DEFAULT, 0 ,1, 1, 1);
INSERT INTO MEMBER VALUES('zxc', 'pw', 'name', 'zxc', '010-0101-0101', 'M', 'email', DEFAULT, SYSDATE, SYSDATE, SYSDATE, DEFAULT, 0 ,1, 1, 1);
INSERT INTO MEMBER VALUES('qwe', 'pw', 'name', 'qwe', '010-0101-0101', 'M', 'email', DEFAULT, SYSDATE, SYSDATE, SYSDATE, DEFAULT, 0 ,1, 1, 1);
INSERT INTO MEMBER VALUES('wer', 'pw', 'name', 'wer', '010-0101-0101', 'M', 'email', DEFAULT, SYSDATE, SYSDATE, SYSDATE, DEFAULT, 0 ,1, 1, 1);
INSERT INTO MEMBER VALUES('sdf', 'pw', 'name', 'sdf', '010-0101-0101', 'M', 'email', DEFAULT, SYSDATE, SYSDATE, SYSDATE, DEFAULT, 0 ,1, 1, 1);
INSERT INTO MEMBER VALUES('xcv', 'pw', 'name', 'xcv', '010-0101-0101', 'M', 'email', DEFAULT, SYSDATE, SYSDATE, SYSDATE, DEFAULT, 0 ,1, 1, 1);

SELECT * FROM MEMBER;
commit;

-- 관리자 뷰 생성
CREATE OR REPLACE VIEW SUPERVISOR_MEMBER
AS
SELECT ID, NAME, NICKNAME, PHONE, GENDER, POSTNUM, ADDRESS, ADDRESS_DETAIL, EMAIL, GRADE, BIRTH, REGDATE, MODIFYDATE, POINT, NEWS, SMS
FROM MEMBER
    JOIN ADDRESS USING(ADDRESS_CODE)
    JOIN GRADE USING(GRADE_CODE)
WHERE STATUS = 'Y';
select * from supervisor_member;
commit;

-- 관리자 회원정보 수정
UPDATE supervisor_member SET NAME = ?, NICKNAME = ?, PHONE = ?, GENDER = ?, POSTNUM = ?, ADDRESS = ?, ADDRESS_DETAIL = ?, EMAIL = ?, GRADE = ?, MODIFYDATE = ?, NEWS = ?, SMS = ? WHERE ID = ?