drop table product;
drop table category;
drop table subcategory;
drop table product_op;
drop table brand;
drop view pdetail;
drop view plist;

-------------------------------테이블

create table CATEGORY(
    CID number primary key,
    CNAME varchar2(100) check (CNAME in ('스피커','헤드셋','헤드폰이어폰','블루투스사운드','마이크'))
);

create table SUBCATEGORY(
    sub_cid number primary key,
    sub_cname varchar2(100) not null,
    cid number not null,
    FOREIGN key (cid) REFERENCES CATEGORY on delete cascade
);

create table BRAND(
    BID number primary key,
    BNAME varchar2(100) not null unique
);

create table PRODUCT(
    PID NUMBER PRIMARY KEY,
    PNAME varchar2(100) not null unique,
    CID number not null,
    SUB_CID number not null,
    BID number not null,
    PRICE number not null,
    STOCK number not null,
    SELLCOUNT number default 0,
    REGDATE date default sysdate,
    MODIFY_DATE date default sysdate,
    DESCRIPTION varchar2(1000),
    USEOPTION varchar2(1) CHECK (useoption in ('Y', 'N')),
    foreign key (cid) REFERENCES category on delete cascade,
    foreign key (sub_cid) references subcategory on delete cascade,
    foreign key (bid) references brand on delete cascade
);

create sequence SEQ_PID;

create table PRODUCT_OP(
    pid number primary key,
    PRODUCT_OP varchar2(200) not null,
    foreign key (pid) references product on delete cascade
);

CREATE TABLE REVIEW( 
  RID NUMBER PRIMARY KEY,
  RTYPE NUMBER,
  PID NUMBER,
  RWRITER VARCHAR2(20),
  RTITLE VARCHAR2(200),
  RCONTENT VARCHAR2(4000),
  RCOUNT NUMBER DEFAULT 0,
  CREATE_DATE DATE,
  MODIFY_DATE DATE,
  STATUS VARCHAR2(1) DEFAULT 'Y' CHECK (STATUS IN('Y', 'N')),
  FOREIGN KEY (PID) REFERENCES PRODUCT(PID),
  FOREIGN KEY (RWRITER) REFERENCES MEMBER(ID)
  );
  
  CREATE TABLE ANSWER( 
  AID NUMBER PRIMARY KEY,
  ATYPE NUMBER,
  PID NUMBER,
  A_RID NUMBER,
  AWRITER VARCHAR2(20),
  ATITLE VARCHAR2(200),
  ACONTENT VARCHAR2(4000),
  ACOUNT NUMBER DEFAULT 0,
  CREATE_DATE DATE,
  MODIFY_DATE DATE,
  STATUS VARCHAR2(1) DEFAULT 'Y' CHECK (STATUS IN('Y', 'N')),
  FOREIGN KEY (PID) REFERENCES PRODUCT,
  FOREIGN KEY (AWRITER) REFERENCES MEMBER(ID),
  FOREIGN KEY (A_RID) REFERENCES REVIEW(RID)
  );

CREATE SEQUENCE SEQ_RID;
CREATE SEQUENCE SEQ_AID;

--- 조회시 사용할 뷰  
           
create or replace view "CONO"."PLIST"("PID", "PNAME", "CNAME", "SUB_CNAME", 
                        "BNAME", "PRICE", "STOCK", "SELLCOUNT", "REGDATE", "MODIFY_DATE", "DESCRIPTION", "USEOPTION")
as
select pid, pname, cname, sub_cname, bname, price, stock, sellcount, regdate, modify_date, description, useoption
from(select pid, pname, cname, sub_cname, bname, price, stock, sellcount, regdate, modify_date, description, useoption
from PRODUCT p join category c on(p.CID = c.CID)
                join subcategory s on(p.sub_cid = s.sub_cid)
                join brand b on(p.bid = b.bid)
order by pid);


commit;

